name: Build Releases


on:
  workflow_dispatch:
    inputs:
      steamworks_sdk_tag:
        description: 'Steamworks SDK Tag:'
        required: true
        type: string
        default: 'sdk-1.60'

      godot_cpp_version:
        description: 'Godot CPP Tag:'
        required: true
        type: string
        default: '4.1'

      godotsteam_version:
        description: 'GodotSteam GDExtension Tag:'
        required: true
        type: string
        default: 'v4.11-gde'


jobs:
  build-linux:
    uses: ./.github/workflows/build-artifact-linux.yml
    with:
      godot_cpp_version: ${{ inputs.godot_cpp_version }}
      steamworks_sdk_tag: ${{ inputs.steamworks_sdk_tag }}
    secrets:
      steamworks_sdk_repo: ${{ secrets.STEAMWORKS_SDK_REPO }}
      steamworks_sdk_repo_token: ${{ secrets.STEAMWORKS_SDK_REPO_TOKEN }}


  build-windows:
    uses: ./.github/workflows/build-artifact-windows.yml
    with:
      godot_cpp_version: ${{ inputs.godot_cpp_version }}
      steamworks_sdk_tag: ${{ inputs.steamworks_sdk_tag }}
    secrets:
      steamworks_sdk_repo: ${{ secrets.STEAMWORKS_SDK_REPO }}
      steamworks_sdk_repo_token: ${{ secrets.STEAMWORKS_SDK_REPO_TOKEN }}


  build-macos:
    uses: ./.github/workflows/build-artifact-macos.yml
    with:
      godot_cpp_version: ${{ inputs.godot_cpp_version }}
      steamworks_sdk_tag: ${{ inputs.steamworks_sdk_tag }}
    secrets:
      steamworks_sdk_repo: ${{ secrets.STEAMWORKS_SDK_REPO }}
      steamworks_sdk_repo_token: ${{ secrets.STEAMWORKS_SDK_REPO_TOKEN }}


  create-bundle:
    needs: [build-linux, build-windows, build-macos]
    uses: ./.github/workflows/create-bundle.yml
    with:
      godot_cpp_version: ${{ inputs.godot_cpp_version }}
      steamworks_sdk_tag: ${{ inputs.steamworks_sdk_tag }}